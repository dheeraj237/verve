@import "tailwindcss";
@import "@milkdown/crepe/theme/common/style.css";

/* Import custom Milkdown styles from official website */
@import "./styles/prosemirror.css";
@import "./styles/crepe.css";

/* Import Obsidian-like editor styles */
@import "./styles/obsidian-editor.css";

@layer base {
  :root {
    --background: 0 0% 100%;
    --foreground: 222.2 47.4% 11.2%;
    
    --card: 0 0% 100%;
    --card-foreground: 222.2 47.4% 11.2%;
    
    --popover: 0 0% 100%;
    --popover-foreground: 222.2 47.4% 11.2%;
    
    --primary: 221.2 83.2% 53.3%;
    --primary-foreground: 210 40% 98%;
    
    --secondary: 210 40% 96.1%;
    --secondary-foreground: 222.2 47.4% 11.2%;
    
    --muted: 210 40% 96.1%;
    --muted-foreground: 215.4 16.3% 46.9%;
    
    --accent: 210 40% 96.1%;
    --accent-foreground: 222.2 47.4% 11.2%;
    
    --destructive: 0 84.2% 60.2%;
    --destructive-foreground: 210 40% 98%;
    
    --border: 214.3 31.8% 91.4%;
    --input: 214.3 31.8% 91.4%;
    --ring: 221.2 83.2% 53.3%;
    
    --radius: 0.5rem;
    
    /* VSCode-like sidebar */
    --sidebar-background: 218 18% 97%;
    --sidebar-foreground: 222.2 47.4% 11.2%;
    --sidebar-border: 214.3 31.8% 91.4%;
    --sidebar-hover: 210 40% 94%;
    
    /* Editor colors */
    --editor-background: 0 0% 99%;
    --editor-gutter: 218 18% 95%;
    --editor-selection: 210 100% 95%;
  }
  
  .dark {
    /* Milkdown Crepe Dark Theme: #1b1c1d = HSL(210, 9%, 11%) */
    --background: 210 9% 11%;
    --foreground: 220 14% 91%;
    
    --card: 210 9% 11%;
    --card-foreground: 220 14% 91%;
    
    --popover: 210 7% 7%;
    --popover-foreground: 220 14% 91%;
    
    --primary: 211 100% 80%;
    --primary-foreground: 210 9% 11%;
    
    --secondary: 210 20% 25%;
    --secondary-foreground: 220 14% 91%;
    
    --muted: 210 15% 13%;
    --muted-foreground: 218 11% 65%;
    
    --accent: 210 15% 15%;
    --accent-foreground: 220 14% 91%;
    
    --destructive: 0 63% 31%;
    --destructive-foreground: 220 14% 91%;
    
    --border: 215 14% 20%;
    --input: 215 14% 20%;
    --ring: 211 100% 80%;
    
    /* Crepe-style dark sidebar */
    --sidebar-background: 210 10% 9%;
    --sidebar-foreground: 220 14% 91%;
    --sidebar-border: 215 14% 20%;
    --sidebar-hover: 210 15% 15%;
    
    /* Editor dark colors matching Crepe */
    --editor-background: 210 9% 11%;
    --editor-gutter: 210 10% 9%;
    --editor-selection: 211 100% 50% / 0.2;
  }
}

@layer base {
  * {
    border-color: hsl(var(--border));
  }
  
  body {
    background-color: hsl(var(--background));
    color: hsl(var(--foreground));
    font-feature-settings: "rlig" 1, "calt" 1;
  }
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 10px;
  height: 10px;
}

::-webkit-scrollbar-track {
  background: hsl(var(--muted));
}

::-webkit-scrollbar-thumb {
  background: hsl(var(--muted-foreground) / 0.3);
  border-radius: 5px;
}

::-webkit-scrollbar-thumb:hover {
  background: hsl(var(--muted-foreground) / 0.5);
}

/* ============================================ */
/* CREPE EDITOR CUSTOMIZATION (Milkdown Style) */
/* ============================================ */

/* Crepe container styling (from Milkdown website) */
.crepe {
  display: flow-root;
  height: 100%;
  flex: 1;
}

.crepe .milkdown {
  display: flow-root;
  height: 100%;
  overflow-y: auto;
  overscroll-behavior: contain;
}

.crepe .milkdown > .ProseMirror {
  height: auto;
  min-height: 100%;
  padding: 2rem 3rem;
  max-width: 800px;
  margin: 0 auto;
}

/* Milkdown * reset (from Milkdown website) */
.milkdown * {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

/* Crepe CSS Variables - Light Theme */
.crepe .milkdown {
  --crepe-color-background: #fdfcff;
  --crepe-color-on-background: #1b1c1d;
  --crepe-color-surface: #f8f9ff;
  --crepe-color-surface-low: #f2f3fa;
  --crepe-color-on-surface: #191c20;
  --crepe-color-on-surface-variant: #43474e;
  --crepe-color-outline: #73777f;
  --crepe-color-primary: #37618e;
  --crepe-color-secondary: #d7e3f8;
  --crepe-color-on-secondary: #101c2b;
  --crepe-color-inverse: #2e3135;
  --crepe-color-on-inverse: #eff0f7;
  --crepe-color-inline-code: #ba1a1a;
  --crepe-color-error: #ba1a1a;
  --crepe-color-hover: #eceef4;
  --crepe-color-selected: #e1e2e8;
  --crepe-color-inline-area: #d8dae0;

  --crepe-font-title: ui-serif, Georgia, Cambria, "Times New Roman", Times, serif;
  --crepe-font-default: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
  --crepe-font-code: ui-monospace, "JetBrains Mono", Menlo, Monaco, "Courier New", Courier, monospace;

  --crepe-shadow-1:
    0px 1px 3px 1px rgba(0, 0, 0, 0.15), 0px 1px 2px 0px rgba(0, 0, 0, 0.3);
  --crepe-shadow-2:
    0px 2px 6px 2px rgba(0, 0, 0, 0.15), 0px 1px 2px 0px rgba(0, 0, 0, 0.3);
}

/* Crepe CSS Variables - Dark Theme */
.dark .crepe .milkdown {
  --crepe-color-background: #1b1c1d;
  --crepe-color-on-background: #f8f9ff;
  --crepe-color-surface: #111418;
  --crepe-color-surface-low: #191c20;
  --crepe-color-on-surface: #e1e2e8;
  --crepe-color-on-surface-variant: #c3c6cf;
  --crepe-color-outline: #8d9199;
  --crepe-color-primary: #a1c9fd;
  --crepe-color-secondary: #3c4858;
  --crepe-color-on-secondary: #d7e3f8;
  --crepe-color-inverse: #e1e2e8;
  --crepe-color-on-inverse: #2e3135;
  --crepe-color-inline-code: #ffb4ab;
  --crepe-color-error: #ffb4ab;
  --crepe-color-hover: #1d2024;
  --crepe-color-selected: #32353a;
  --crepe-color-inline-area: #111418;

  --crepe-shadow-1:
    0px 1px 2px 0px rgba(255, 255, 255, 0.3),
    0px 1px 3px 1px rgba(255, 255, 255, 0.15);
  --crepe-shadow-2:
    0px 1px 2px 0px rgba(255, 255, 255, 0.3),
    0px 2px 6px 2px rgba(255, 255, 255, 0.15);
}

/* Cursor styling (from Milkdown website) */
.crepe .cm-cursor,
.crepe .cm-dropCursor {
  border-left-color: #000 !important;
}

.dark .crepe .cm-cursor,
.dark .crepe .cm-dropCursor {
  border-left-color: #fff !important;
}

/* Table overflow handling */
.crepe table td {
  overflow: auto;
}

/* CodeMirror editor basic styling */
.crepe .cm-editor {
  height: 100%;
  font-family: ui-monospace, "JetBrains Mono", Menlo, Monaco, "Courier New", Courier, monospace;
  font-size: 0.875rem;
  background-color: #f6f8fa !important;
}

.dark .crepe .cm-editor {
  background-color: #0d1117 !important;
}

.crepe .cm-scroller {
  overflow: auto;
}

/* CodeMirror line numbers */
.crepe .cm-gutters {
  background-color: #f6f8fa;
  border-right: 1px solid #d0d7de;
  color: #57606a;
  padding-right: 0.5rem;
}

.dark .crepe .cm-gutters {
  background-color: #0d1117;
  border-right: 1px solid #21262d;
  color: #8b949e;
}

.crepe .cm-lineNumbers .cm-gutterElement {
  padding: 0 0.5rem;
  min-width: 2rem;
  text-align: right;
  font-size: 0.75rem;
}

.crepe .cm-activeLineGutter {
  background-color: rgba(0, 0, 0, 0.03);
}

.dark .crepe .cm-activeLineGutter {
  background-color: rgba(255, 255, 255, 0.04);
}

/* Control paragraph/heading spacing in Crepe (minimal adjustments) */
.crepe .milkdown .ProseMirror p {
  margin: 0.5rem 0;
}

.crepe .milkdown .ProseMirror h1,
.crepe .milkdown .ProseMirror h2,
.crepe .milkdown .ProseMirror h3,
.crepe .milkdown .ProseMirror h4,
.crepe .milkdown .ProseMirror h5,
.crepe .milkdown .ProseMirror h6 {
  margin-top: 1.5rem;
  margin-bottom: 0.75rem;
}

.crepe .milkdown .ProseMirror h1:first-child,
.crepe .milkdown .ProseMirror h2:first-child,
.crepe .milkdown .ProseMirror h3:first-child {
  margin-top: 0;
}

.crepe .milkdown .ProseMirror ul,
.crepe .milkdown .ProseMirror ol {
  margin: 0.5rem 0;
  padding-left: 1.5rem;
}

.crepe .milkdown .ProseMirror li {
  margin: 0.25rem 0;
}

.crepe .milkdown .ProseMirror li > p {
  margin: 0;
}

/* ProseMirror focus styling */
.ProseMirror:focus-visible {
  outline: none;
}

.ProseMirror-selectednode {
  outline: none;
  outline: 2px solid hsl(var(--primary));
  outline-offset: 2px;
}

/* Milkdown slash menu (from website) */
.milkdown .milkdown-slash-menu .tab-group {
  padding-bottom: 0.75rem;
}

/* ============================================ */
/* MARKDOWN PREVIEW (Read-only mode)           */
/* ============================================ */

/* Markdown preview container */
.markdown-preview {
  padding: 2rem 3rem;
  max-width: 800px;
  margin: 0 auto;
}

/* Typography */
.markdown-preview h1,
.markdown-preview h2,
.markdown-preview h3,
.markdown-preview h4,
.markdown-preview h5,
.markdown-preview h6 {
  color: hsl(var(--foreground));
  font-weight: 600;
  margin-top: 1.5rem;
  margin-bottom: 0.75rem;
}

.markdown-preview h1 {
  font-size: 2em;
  border-bottom: 1px solid hsl(var(--border));
  padding-bottom: 0.3rem;
}

.markdown-preview h2 {
  font-size: 1.5em;
  border-bottom: 1px solid hsl(var(--border));
  padding-bottom: 0.3rem;
}

.markdown-preview h3 {
  font-size: 1.25em;
}

.markdown-preview p {
  margin: 0.75rem 0;
  line-height: 1.6;
}

/* Lists */
.markdown-preview ul,
.markdown-preview ol {
  margin: 0.75rem 0;
  padding-left: 2rem;
}

.markdown-preview li {
  margin: 0.25rem 0;
  line-height: 1.6;
}

/* Links */
.markdown-preview a {
  color: hsl(var(--primary));
  text-decoration: none;
  font-weight: 500;
}

.markdown-preview a:hover {
  text-decoration: underline;
}

/* Blockquotes */
.markdown-preview blockquote {
  border-left: 4px solid hsl(var(--primary));
  background-color: hsl(var(--muted) / 0.5);
  padding: 0.5rem 1rem;
  margin: 1rem 0;
  font-style: italic;
}

/* Inline code */
.markdown-preview code {
  background-color: hsl(var(--muted));
  color: hsl(var(--primary));
  padding: 0.2em 0.4em;
  border-radius: 0.25rem;
  font-size: 0.9em;
  font-family: ui-monospace, "JetBrains Mono", Menlo, Monaco, "Courier New", Courier, monospace;
}

/* Code blocks */
.markdown-preview pre {
  margin: 1rem 0;
  padding: 1rem;
  background-color: #f6f8fa;
  border-radius: 0.5rem;
  border: 1px solid hsl(var(--border));
  overflow-x: auto;
}

.dark .markdown-preview pre {
  background-color: #0d1117;
}

.markdown-preview pre code {
  background: none;
  padding: 0;
  font-family: ui-monospace, "JetBrains Mono", Menlo, Monaco, "Courier New", Courier, monospace;
  font-size: 0.9em;
  line-height: 1.6;
  color: #24292e;
}

.dark .markdown-preview pre code {
  color: #e6edf3;
}

/* Tables */
.markdown-preview table {
  border-collapse: collapse;
  width: 100%;
  margin: 1.5rem 0;
  border: 1px solid hsl(var(--border));
  border-radius: 0.5rem;
}

.markdown-preview thead {
  background-color: hsl(var(--muted));
}

.markdown-preview tbody tr {
  border-bottom: 1px solid hsl(var(--border));
}

.markdown-preview tbody tr:hover {
  background-color: hsl(var(--muted) / 0.3);
}

.markdown-preview th,
.markdown-preview td {
  border: 1px solid hsl(var(--border));
  padding: 0.75rem 1rem;
  text-align: left;
}

.markdown-preview th {
  font-weight: 600;
  border-bottom: 2px solid hsl(var(--border));
}

/* Images */
.markdown-preview img {
  max-width: 100%;
  height: auto;
  border-radius: 0.5rem;
  margin: 1rem 0;
  border: 1px solid hsl(var(--border));
}

/* Horizontal rules */
.markdown-preview hr {
  border: none;
  border-top: 2px solid hsl(var(--border));
  margin: 2rem 0;
}

/* Task lists */
.markdown-preview input[type="checkbox"] {
  margin-right: 0.5rem;
  cursor: pointer;
}

/* Mermaid diagrams */
.markdown-preview .mermaid {
  background-color: transparent;
  padding: 1rem;
  border-radius: 0.5rem;
  border: 1px solid hsl(var(--border));
}
